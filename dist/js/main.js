"use strict";var ScreenController=function(){this.textarea=document.querySelector("#text"),this.textarea.addEventListener("keydown",this._handleArgs.bind(this),!0),this.callbacks={},this.systemID="system",this.screenData,this.composing=!1,this.compositionData,this.compositionCommand};ScreenController.prototype._handleArgs=function(event){if(this.composing){if(13==event.which){var args=this._getArgs();"quit"==args[0]&&this.exitComposition()}}else{if(8===event.which)return this.removeChar(),void event.preventDefault();if(13==event.which){event.preventDefault();var args=this._getArgs();this.message("");var callback=this.getCommand(args[0]);if(callback)if(console.log("type: ",typeof callback),console.log(callback),"string"==typeof callback){var commandArgs=args[1]||null;eval("("+callback+")")(commandArgs)}else callback(args.slice(1));else{if(""===args[0])return;this.sysMessage(args[0]+": command not found")}}}},ScreenController.prototype.getCommand=function(e){return this.callbacks[e]},ScreenController.prototype.setCommand=function(e,t){this.callbacks[e]=t},ScreenController.prototype.sysMessage=function(e){this.message("- "+this.systemID+": "+e)},ScreenController.prototype._getArgs=function(){var e=this._load().trim(),t=e.split("\n"),s=t[t.length-1],n=s.split(" ");return n},ScreenController.prototype._load=function(){return this.textarea.value},ScreenController.prototype._save=function(e){this.textarea.value=e,this.textarea.scrollTop=this.textarea.scrollHeight},ScreenController.prototype.message=function(e){var t=this._load();t+=e+"\n",this._save(t)},ScreenController.prototype.clear=function(){this._save("")},ScreenController.prototype.setSystemID=function(e){this.systemID=e},ScreenController.prototype.enterComposition=function(e){console.log("entering composition for command: "+e),this.compositionCommand=e,this.composing=!0,this.screenData=this._load(),this.clear(),this.sysMessage("type 'quit' on a new line to exit composition");var t=this.getCommand(e);t&&this.message(t)},ScreenController.prototype.exitComposition=function(){console.log("exiting composition"),this.composing=!1,this.compositionData=this._load(),this._saveComposition(),this.clear(),this._save(this.screenData)},ScreenController.prototype._saveComposition=function(){var e=this.compositionData.trim(),t=e.split("\n"),s=void 0;s="-"===t[0][0]?t.slice(1,-1):t.slice(0,-1);var n=s.join("\n");this.setCommand(this.compositionCommand,n)},ScreenController.prototype.saveFunction=function(arg,func){this.setCommand(arg,function(){return eval(func)})},ScreenController.prototype.addChar=function(e,t){var s=this._load();if(t){var n=s.slice(0,t),o=t==s.length-1?s[t]:s.slice(t,s.length-1);n+=e;var i=n+o;console.log(n,o),this._save(i)}else s+=""+e,this._save(s)},ScreenController.prototype.removeChar=function(e){var t=this._load();if(e){console.log("splicing at "+e);var s=t.splice(e,1);this._save(s)}else{var n=t[t.length-1];if("\n"!==n){var s=t.slice(0,-1);this._save(s)}}};var screen=new ScreenController;screen.sysMessage("use help for a list of available commands"),screen.setCommand("help",function(e){if(e.length)screen.sysMessage("i'm sorry, i can't help "+e);else{var t=Object.keys(screen.callbacks).join("\n ");screen.sysMessage("commands available: \n "+t)}}),screen.setCommand("clear",function(){screen.clear()}),screen.setCommand("setid",function(e){if(e.length){var t=e.join(" ");screen.sysMessage("setting new system id to: "+t),screen.setSystemID(t)}else screen.sysMessage("please provide a new id\n		useage: setid [id]\n		e.g.: setid HAL 9000\n			")}),screen.setCommand("bobby",function(){screen.sysMessage("damnit bobby!")}),screen.setCommand("time",function(){var e=new Date;screen.message(e)}),screen.setCommand("print",function(){print()}),screen.setCommand("compose",function(e){e.length?screen.enterComposition(e[0]):screen.sysMessage("please provide a command name to begin composing\n		useage: compose [command]\n		e.g.: compose time\n			")}),screen.setCommand("function",function(e){if(e.length>1){console.log(e.length);var t=e[0],s=e.slice(1).join(" ");console.log(s),screen.saveFunction(t,s)}else screen.sysMessage("please provide a function name and function body\n		useage: function [name] [body]\n		e.g.: function alert window.alert('hello');\n			")});